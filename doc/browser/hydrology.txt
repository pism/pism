/*! \page hydrology On adding hydrology submodels to PISM

PISM needs better hydrology submodels.  Users and developers who want to try adding such models are encouraged to do so.  On the general topic of adding functionality to PISM, see the <a href="http://www.pism-docs.org/wiki/doku.php?id=committing">Committing to PISM</a> page.  Please do become a contributor if you want to.

Subglacial and supraglacial hydrology are addressed here, and primarily the former.  (Users interested in addressing intraglacial hydrology, please see [\ref AschwandenBuelerKhroulevBlatter] and also look at the DrainageCalculator object.  But after that you are on your own.)

The ice sheet model base class (IceModel) has these inputs and outputs which are related to adding supra- and sub-glacial hydrology process models to PISM: 
  -# IceModel needs an upper surface mass balance value, the final result of any mass-related processes occurring at the surface.  This SMB value is the rate at which mass appears at the top of the incompressible ice after the completion of firn processes including melt, runoff, pooling of meltwater, refreeze of meltwater, and so on.  Thus a supraglacial hydrology model is partly responsible for "constructing" this SMB.
  -# IceModel needs an upper surface enthalpy value, the final result of any energy-related processes occurring at the surface, again at the top of the incompressible ice [\ref AschwandenBuelerKhroulevBlatter].  Again, a supraglacial hydrology model is partly responsible for "constructing" this upper surface enthalpy boundary condition.
  -# When run in the default enthalpy mode (i.e. using the default conservation of energy model and not the \c -cold mode), IceModel is already computing a basal (subglacial) melt rate, at least that portion of the basal melt rate which is determined by energy balance within and on the boundary of the deforming polythermal ice sheet [\ref AschwandenBuelerKhroulevBlatter].  Thus this portion of the basal melt rate should (i.e. excluding intraglacial drainage, or moulin drainage, or liquid water transport under the ice sheet margin) should be treated as an input to the subglacial hydrology model.  Calculation of the basal melt rate should not (generally) be treated as a function of the subglacial hydrology model.
  -# IceModel needs a basal strength parameter \f$\tau_c\f$ to use the SSA model for sliding correctly.  This value is the aggregate yield stress (or pseudo-yield-stress in a power law) of the subglacial layer.  It must be generated by, or at least it is strongly related to, any subglacial hydrology model.

Regarding 1 and 2, the PISMSurfaceModel object generates, as its outputs, these IceModel inputs.  PISMSurfaceModel generally gets information like precipitation and 2m air temperature from the PISMAtmosphereModel object "above" it.  Generally a supraglacial hydrology model would reimplement PISMSurfaceModel.

Regarding 3, modifying the basal melt rate by a parameterization you supply is something you should let us know about if you want it.  For now it requires "intervening" in the job done by the IceModel::enthalpyAndDrainageStep().  Abstraction in the base code may be desirable before such intervention.

Regarding 4, the existing PISMYieldStress object essentially implements [\ref BBssasliding], so it generates a \f$\tau_c\f$ output.  We \e do \e not regard the subglacial model in [\ref BBssasliding] as the final model.  It is a concrete starting point, but we would like to replace it with more physical and better understood parameterizations.  The current PISMYieldStress is, however, an example of a subglacial process model which connects local basal water sources, specifically basal melt rate, back to basal resistance (as yield stress).


\section subglacialhydrology Subglacial hydrology models

Garry Clarke [\ref Clarke05] says this: <i>Water pressure can exert a decisive influence on ice flow dynamics, controlling both the degree of frictional interaction between a glacier and its bed and, in the case of soft-bedded glaciers, the strength of the subglacial sediment.</i>

He also gives the following list which relates to subglacial models, here edited to emphasize that it is a list: <i>The pressure \f$p_w\f$ of subglacial water is an independent variable that can vary temporally and spatially in a complicated manner that is determined by the</i>
  - (1) <i>balance between influx and outflux of water,</i>
  - (2) <i>the geometry of the subglacial water system,</i>
  - (3) <i>the physical properties of the glacier substrate,</i>
  - (4) <i>thermodynamic conditions near the ice-bed interface, and</i>
  - (5) <i>ice overburden pressure.</i>

Pressure (or head) gradients in subglacial water will dominate its direction of flow.  Furthermore, though the subglacial water pressure will not actually be equal to, or proportional to, the ice overburden pressure, nonetheless one would expect the direction of subglacial aquifer flow to be related more to the (horizontal) gradient of ice \e thickness more than the gradient of either ice surface elevation or bed elevation.

So far, PISM has mostly avoided being responsible for modeling a subglacial water pressure field, and similarly it has avoided modeling the velocity of subglacial liquid.  Any "serious" subglacial hydrology model for saturated till or other subglacial material presumably involves model state variables like liquid pressure and liquid velocity.  Though we would like to keep out of the core state variable space of PISM (i.e. out of IceModel), "adding a hydrology model to PISM" means modeling these fields.  We do not currently know how to handle them in a way a generic user would want to model them, and there are no obvious default settings.  This document is about how to implementing what you want in terms of hydrology models, so that there are modeled pressure and/or velocity fields.

This document accepts the partly-fictional but convenient hypothesis that PISM already handles (4) and (5) in Clarke's list adequately, using the model in [\ref AschwandenBuelerKhroulevBlatter] for (4) and a simple hydrostatic approximation for (5).   But (2) and (3) are things we don't have good remote-sensed information for at all.  Nor do we have good default ways of generating these geometrical/physical properties near the base.

The ad hoc way PISM currently addresses (2) and (3) is the \c -topg_to_phi option.  This sets the \c tillphi (i.e. \f$\phi\f$ in [\ref BBssasliding]) field of till friction angle parameters.  We plan that PISM will be able to invert surface velocities to determine \c tillphi.

Thus it comes down to these questions to the PISM user:  What model for the pressure of subglacial water do you want?  And what model for the amount of flow for a given pressure gradient (i.e.~Darcy relation) do you want?  For now these probably rhetorical questions.

The model in [\ref BBssasliding] and [\ref BKAJS], implemented by PISMYieldStress, generates a map of basal (pseudo-) yield stress \f$\tau_c=\tau_c(t,x,y)\f$ which evolves in time through its dependence on subglacial water amount and also on the ice geometry (overburden pressure).  A simpler model in [\ref Martinetal2011] has the map of basal (pseudo-) yield stress still depends on time but only through the changing overburden pressure.  An even simpler model, which we generally have not used in applications, is to have the (pseudo-) yield stress be fixed independent of time, \f$\tau_c(x,y)\f$.  This is enabled in PISM by the \c -hold_tauc option, which chooses the PISMConstantYieldStress derived class of PISMYieldStress.  We are supposing this is an oversimplification because the cyclic or time-dependent behavior of sliding ice sheets and glaciers depends on subglacial liquid water properties (quantity, pressure, etc.) being controlled by basal friction heating and other thermodynamic effects [\ref AschwandenBuelerKhroulevBlatter], but also feeding back to affect the resistance.  Generally we suppose \f$\tau_c\f$ varies in time and space.

PISM does not currently offer an alternative to a single configurable parameter (i.e. \c hmelt_max which has default setting 2 m) for the maximum amount of latent energy which is stored at the ice base.  Note that the amount of subglacial water is both related (in some hard to parameterize manner) to subglacial pressure, \e and it determines a critical subglacial-energy-storage field, namely how much latent heat is present.  Thus the amount of subglacial water controls the possibility of refreeze onto the base of the ice, and it relates to how quickly the basal resistance can change in response to energy balance changes at the base.  We could add, if needed, a bit of code to PISM to allow other information to affect the maximum setting on the variable in question (\c bwat), besides the single configuration constant \c hmelt_max.

An option to diffuse basal water already exists in PISM.  It is turned on by the option \c -diffuse_bwat. The configuration parameters \c bwat_diffusion_distance and \c bwat_diffusion_time control the diffusivity. See equation (11) in [\ref BBssasliding].



\section tryflowersclarke Specific possibilities

Flowers and Clarke [\ref FlowersClarke2002_theory], for example have a Darcian flow type water transport scheme in which water flows from high to low fluid potential.  

\b Question:  Could such a water transport equation (easily) be implemented in PISM or are there obvious complications?

\b Answer:  There is one outstanding, foreseeable complication in adding a Darcian liquid transport process, namely \e stiffness of the resulting combined liquid flow and ice flow.  It is not seriously addressed by any of the literature we know about, for the context of coupled ice flow, associated ice sheet geometry change, and subglacial liquid flow.  (Flowers and Clarke only mention a simpler stiffness issue, relating ablation processes and subglacial flow time scales.)  This "stiffness" is the difference between the long time scales for interesting ice dynamical changes and the short time scales for subglacial liquid flow.  For the former we might say that the intrinsic time scale is closer to years than months or decades.  For the latter, [\ref FlowersClarke2002_theory] says "the dynamics time step (seconds to minutes)".

We call the problem "stiffness" only to match the term used when solving ODE systems numerically [e.g. \ref AscherPetzold].  If you solve the ODE system
	\f[ \begin{bmatrix}\dot x(t) \\ \dot y(t)\end{bmatrix} = \begin{bmatrix} -100 & 9 \\ 9  & -1\end{bmatrix} \begin{bmatrix}x(t) \\ y(t)\end{bmatrix} \f]
for some initial conditions, for example, then you will find you are generating a combination of two exponential curves.  The solution components have time-scales separated by a factor of 500 because the eigenvalues of the matrix are \f$\lambda_1=-0.18847, \lambda_2=-100.81\f$, so the general solution is essemtoa;;u
	\f[ x(t) = c_1 e^{-0.2t} + c_2 e^{-100 t}.\f]
Explicit time-stepping methods for this ODE system will fail without taking very short time steps to resolve the fast decay of the \f$e^{-100 t}\f$ mode.  That fast mode is actually uninteresting, however, because the solution behaves like \f$x(t) \approx c_1 e^{-0.2t}\f$ over any significant time interval.  Modeling goals usually have to do with features of these slower and more substantial decay modes.  This stiffness idea applies euqally when we consider the PDE version of these problems.  The standard  advice is to solve such a "stiff" ODE with an implicit time-stepping scheme, of course. 

Obviously, it is hard to pin down the meaning of "intrinsic time scale" for ice flow.  Different parts of an ice sheet or even a single glacier have such different active physics.  But the analogy is clear:  The slow process is ice flow.  The fast process is subglacial water flow.  If we want to model changes to the geometry and flow of ice sheets, which is PISM's goal, then the fast time-scale processes of the subglacial aquifer must somehow be kept "out of the way", in the sense that only the aggregate effect of the subglacial processes needs to be determined every ice sheet model time step (e.g.~months).  This means extracting the effect of thousands to millions of "seconds to minutes" subglacial aquifer time steps without simulating all of them.  If the hydrological time steps are actually computed then there will never be runs long enough to see the evolving ice sheet flow; there will never be the decades/centuries/millenia runs needed to understand the ice dynamics.

Flowers and Clarke [\ref FlowersClarke2002_theory] use an implicit finite difference method.  This is good, and presumably necessary.  However, the subglacial system is quite nonlinear.  It probably exhibits something like "self-organized criticality" [buzzword warning: \ref Bak] that many sediment/flow systems exhibit [see also \ref Schoofmeltsupply].  To get a clear picture of the connection between basal water amount and basal resistance applied to the glacier, either the system must be modeled in reasonable detail or you have to put in parameterizations from the beginning that describe the macroscopic aggregate behavior.  In the presence of realistically-rough bedrock topography from measurements, and with heterogeneous basal type evolving from subglacial liquid flow, and even if an implicit time-stepping mehtod for basal hydrology is stable when using month-long timesteps appropriate to ice dynamics, there is no particular reason to believe it is modeling anything real if the underlying hydrology processes have "seconds to minutes" time steps.

Jesse Johnson's PhD thesis [see \ref JohnsonFastook] is another, quite different, attempt to model subglacial hydrology, compared to the Flowers and Clarke approach.  Among other things, that model gave an interesting prediction for the distribution of subglacial lakes under the East Antarctic Ice Sheet.


\section moulin Connection of supraglacial hydrology to a subglacial model

Regarding (1) in Clarke's list, I think it clearly requires modeling intra-glacial drainage in some really-simplified way for now.  Among other things, (1) requires connecting the subglacial aquifer to supraglacial hydrology, groundwater, and surface water on ice-free-land, all in some additional simplified manner.  Schoof's work [\ref Schoofmeltsupply] also suggests generally that modeling the connection between surface hydrology and subglacial hydrology will only be effective if the correct time-average is computed in determining the basal resistance effect.

Note that for any foreseeable modification of PISM, the \e mass of surface melt water which is transported rapidly to the base, through moulins or a distributed crack system, would be put in a thin layer whose thickness would not affect ice sheet geometry directly.  Without significant additional re-design, PISM can not change the ice sheet geometrically simply from the thickness of subglacial water layers.  Again we don't really  have a default method for such geometry change, though clearly if the subglacial water is at the overburden pressure and the thickness is substantial (%e.g. subglacial lakes) then we are missing something geometrical.  Any subglacial model which is useful to ice dynamics must, however, determine how the \e shear stress at the base of the ice is affected.

The intraglacial model in [\ref PhillipsRajaramSteffan2010] should be treated cautiously at this time, not least because it explains an observed phenomenon (warm near-margin ice) by a new mechanism (intra-glacial drainage) when that phenomenon is already fully-explained by old models (i.e.~advection of dissipation-heated near basal ice into the vicinity of the margin).


\section forwardtohydrology Going forward

The above discussion suggests that any new hydrology model for PISM will involve: 
  - a choice of constants which are hard to constrain by observations, and 
  - the implementation of a partly-implicit scheme to solve a system of nonlinear equations at each  time-step of the subglacial aquifer model.

Unfortunately, for most trial implementations, here is a probable consequence:
  - If the model is realistic enough to model the processes you think are "down there" then it will have very short timesteps.  It may only work on single-glacier spatial scales and decades/centuries time scales.
But, if the first try is lucky, then we will get informaiton on helpful parameterizations to put in PISM.  

The only way to find the right knobs is to try some process models which have knobs.  Validation with surface measurements, especially time-dependent ones, is vital.

Compared to [\ref FlowersClarke2002_theory], the existing major applications of the current PISM subglacial and sliding model [\ref BKAJS, \ref Martinetal2011] are "close to the data".  That is, the remote-sensed bed topography and surface velocities used in these works probably say more about the subglacial system, though this information is very indirect, than do known, global, "physical" constraints on the process parameters in the [\ref FlowersClarke2002_theory] model and its variants.  On the other hand the parameters in the subglacial model are both simpler in meaning, and less physical, in current PISM.  Thus the situation is complicated: we want more physically-based subglacial models than we have already implemented, but we also want modeling workflows and data pathways that do not lead through process models with too many "blind" parameters.



*/  /* <--- IF THIS END-OF-COMMENT IS LOST, CONFUSION RESULTS ... */


