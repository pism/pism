
\section{Getting started}\label{sect:start}\index{PISM!getting started}

In this section we give an extended example applying PISM to model the Greenland ice sheet.  We use recent data sets provided by the \href{http://websrv.cs.umt.edu/isis/index.php/SeaRISE_Assessment}{Sea-level Response to Ice Sheet Evolution (SeaRISE)}) group.  SeaRISE is a community-organized assessment process to provide an upper bound of ice sheet contributions to sea level in the next 100--200 years, especially for the next IPCC report in 2013.

The example in this section is a quick, hands-on first look at PISM.  It is not an in-depth tutorial, and many details of what is happening will only be explained later.  The sections on the older EISMINT-Greenland and EISMINT-Ross modeling cases, for instance, do a more complete job of explaining the ways users will need to preprocess not-so-clean input data and then make, and evaluate, modeling choices.

The PISM output figures in this section were produced using a supercomputer.  However, in order for the examples here to run on a typical workstation, a rather coarse $20\,\textrm{km}$ grid is used.  One purpose of PISM is to make much higher spatial resolution actually possible, but it does indeed require large-scale \emph{parallel} processing.


\subsection{Install PISM}

See the \emph{Installation Manual} at \url{http://www.pism-docs.org}
to install PISM.  Once installed, executables \texttt{pismr} and \texttt{pclimate}, and several others, will be in the \texttt{bin} subdirectory of the main PISM directory.  The main PISM directory might be at \texttt{/home/username/pism-dev/}, for example.  The instructions below assume you start from that main PISM directory.  We also assume you are using a \texttt{bash} shell or at least one that accepts \texttt{bash} syntax.


\subsection{Obtain and preprocess the input data}

The NetCDF data file which we use for input is freely-available online.  Descriptions of the data it contains, and a link to the file itself, are on this web page: 
\medskip

\centerline{\protect{\textbf{\url{http://websrv.cs.umt.edu/isis/index.php/Present_Day_Greenland}}}}
\medskip

\noindent The quickest way to get the file itself is to do
\begin{verbatim}
$ cd examples/searise-greenland
$ ./preprocess.sh
\end{verbatim}
\noindent The script \texttt{preprocess.sh}\footnote{\protect{This script requires \texttt{wget} and also NCO (NetCDF Operators; \url{http://nco.sourceforge.net/})}.} downloads the ``master'' present-day data set and adjusts it to make it PISM-readable.\footnote{The script looks for \texttt{Greenland\_5km\_v0.93.nc}.  If a different version number is desired, edit the script to change the value of ``\texttt{DATAVERSION}'' and modify the download URL appropriately.  Metadata in other SeaRISE-Greenland files may differ, so additional modifications of \texttt{preprocess.py} may be needed to produce PISM-readable NetCDF files.}

Pre-processing creates three NetCDF files from the master data, each of which has small ``metadata'' changes so that they can be read by PISM.  These metadata can be listed at the command line, or put in a text file, by \texttt{ncdump -h}.  Two of the new files contain famous time-dependent paleo-climate records from ice core (\texttt{pism_dT.nc} has GRIP) and seabed core records (\texttt{pism_dSL.nc} has SPECMAP).

Any of these NetCDF files can be viewed with \texttt{ncview} or other NetCDF visualization tools.  (See Table \ref{tab:NetCDFview} below.)  Application of IDV to \texttt{Greenland_5km_v0.93.nc} itself produced Figure \ref{fig:sr-input}, for example.

\begin{figure}[ht]
\centering
\mbox{\includegraphics[width=2.0in,keepaspectratio=true]{sr-greenland-thk}
  \qquad
  \includegraphics[width=2.0in,keepaspectratio=true]{sr-greenland-topg}
  \qquad
  \includegraphics[width=2.0in,keepaspectratio=true]{sr-greenland-prcp}}
\caption{The input present-day ice thickness (left; m), bedrock elevation (center; m), and present-day precipitation (right; m $\text{a}^{-1}$ ice equivalent) for SeaRISE-Greenland.}
\label{fig:sr-input}
\end{figure}


\subsection{Run PISM}   \label{subsect:runscript}  We are ready to run PISM, but, like some other Unix programs, PISM allows \emph{a lot} of command-line options.  Furthermore there are configuration parameters that get read from a file, namely in \texttt{lib/pism_config.nc}.  Because it is an ice flow simulation program designed to handle many different ice sheet, shelf, and glacier configurations, the list of user-configurable flags and parameters is quite long.  For a complete list see
\begin{center}
\url{http://www.pism-docs.org/doxy/html/config.html}
\end{center}

These many options and parameters imply that one should often build a \emph{script} to run PISM with the correct options.  We have done this for SeaRISE-Greenland, and the script is in the PISM download.

As explained in the rest of this \emph{User's Manual}, modeling ice sheets requires the integration of paleo-climatic and long-time-scale information into the model state, so our main script is called ``\texttt{spinup.sh}''.  The spin-up stage is the one which generally requires the most processor-hours, compared to a follow-on ``forecast'' stage.

To see what the run involves, do this:
\begin{verbatim}
$ PISM_DO=echo
$ ./spinup.sh
\end{verbatim}
\noindent Setting the environment variable \texttt{PISM_DO} in this way tells \texttt{spinup.sh} just to print out the commands it is about to run, not do them.  Note that ``\texttt{mpiexec -n 2 pismr}'' appears in the PISM runs done by \texttt{spinup.sh}.  This means that the PISM executable \texttt{pismr} is run in parallel on two processes (e.g.~cores).  The executable name ``\texttt{pismr}'' stands for the standard ``run'' mode of PISM, in contrast to other, specialized run modes described later.

For the rest of this example, we assume you have a workstation with 8 cores, but this will all work with 1 to 500 processes, with nearly-proportional scaling in speed.

The script \texttt{spinup.sh} starts by ``bootstrapping.''  This term describes the creation, by heuristics and simplified models, of the kind of full initial conditions needed for the evolving, time-dependent model.  Concretely, the first 100 model year run with 8 processes will look like this (\emph{but there is no need to type here \dots patience \dots}):
\small
\begin{verbatim}
  mpiexec -n 8 pismr -ocean_kill -eta -skip 2 -boot_from pism_Greenland_5km_v0.93.nc \
    -Mx 76 -My 141 -Lz 4000 -Lbz 2000 -Mz 41 -Mbz 16 \
    -atmosphere searise_greenland -surface pdd -pdd_fausto \
    -y 100 -o g20km_pre100.nc
\end{verbatim}
\normalsize
The options describe a $76\times 141$ point grid in the horizontal, which gives 20 km grid spacing in both directions.  There are also important choices about the vertical extent and resolution of the computational domain; more on those later.  

Now, instead of typing-in the above PISM command with all its options, get the run going by resetting the environment variable \texttt{PISM_DO} to empty, and actually run the script:
\begin{verbatim}
$ export PISM_DO=
$ ./spinup.sh 8 >> out.spin20km &
\end{verbatim}
\noindent Because we have re-directed the text output, PISM will show what it is doing in the text file \texttt{out.spin20km} as it runs in the background.  Using the GNU tool \texttt{less}\index{less, a GNU tool} is a good way to watch such a growing text file.  Reasonably quickly---within a minute---the run will produce the early flow result in \texttt{g20km_pre100.nc}.

Soon after that a boundary-conditions sample result will appear: \texttt{g20km_climate-500a.nc}.  Such output from executable \texttt{pclimate} is effectively a movie of the stored climatic inputs to the Greenland ice sheet model, plus the results from surface models, especially for surface mass balance, but \texttt{pclimate} assumes that the input geometry is held steady and does no ice dynamics modeling.  This is a convenient way to, early in the modeling process, look at the critical surface mass balance and surface temperature inputs to the ice dynamics, as they are (and must be) simulated/modeled in this kind of spinup.

\subsection{Spinup}  \label{subsect:spinupsketch}  The next paragraphs describe what happens and what files are produced by the run which is underway.  We believe that the modeling choices represented here are reasonable choices, but there is certainly no claim that this is the ``only way to do it''.  The user is encouraged to try other option combinations and to do experiments.  That is the point of a model!

Back to the run.  After the completion of the first 100 model year run, the one giving \texttt{g20km_pre100.nc} as output, we then work to generate a more-credible enthalpy field in which the modeled ice internal energy, its temperature, its softness, its flow velocity, its stored basal water, and its basal melt rate are all in better balance with the ice sheet geometry.  In particular the upper and lower surfaces of this modeled ice are held fixed at this stage.  The upper surface is held fixed by the option \texttt{-no_mass}, while the latter is held fixed because we do not yet apply a bed deformation model (compare below).  Thus the resulting enthalpy field is in approximate equilibrium with a velocity field for which the surface kinematical equation \cite{Fowler} is \emph{not} satisfied.  Also there is no sliding at this stage because good sliding requires good basal strength which requires good basal melt rates in PISM.  We sometimes call this early stage ``pre-spinup''.  In any case it follows on ``bootstrapping'' and comes before ``actual spinup'' which uses the paleo-climatic record.  This ``pre-spinup'' stage goes for 50,000 model years and yields the file \texttt{g20km_steady.nc} at the end.  Along the way the file \texttt{ex_g20km_steady.nc} is updated at every 500 model years, and it can be used to evaluate the degree to which we have reached a thermomechanically-coupled steady state.

Before the start of the actual spinup and its paleo-climate forcing, we add another short smoothing run which produces \texttt{g20km_SIA.nc} after 100 model years.  This model state has approximate thermomechanical equilibrium and has a surface geometry which is close to the present-day one.  But, by using a bit of nonsliding SIA-type flow we have reduced a bit the driving stresses relative to those in the input ice sheet geometry.

\begin{figure}[ht]
\centering
%  temppabase from last time in ex_g10km_steady.nc and driving stress taud from g10km_SIA.nc
\mbox{\includegraphics[width=2.0in,keepaspectratio=true]{temppabase}
  \qquad \includegraphics[width=2.1in,keepaspectratio=true]{taud}}
\caption{A look at the model state at the beginning of paleo-climate-modeling ice sheet spinup.  Left: pressure-adjusted basal temperature ($\phantom{|}^\circ$C).  Right: driving stress $\rho g H |\grad h|$ (Pa).}
\label{fig:sr-spinstart}
\end{figure}

The resulting model state in \texttt{g20km_SIA.nc} is our model for the state of the Greenland ice sheet at the beginning of the paleo-climate data provided in the SeaRISE data set, namely 125,000 B.P.  There is, obviously, great uncertainty in this model for the distant past of the Greenland ice sheet.  Two views of the 10km model grid version of this state are in Figure \ref{fig:sr-spinstart}.

\begin{figure}[ht]
\centering
%  thk, cbase, csurf from g10km_0.nc
\mbox{\includegraphics[width=2.25in,keepaspectratio=true]{thk}
  \qquad \includegraphics[width=2.0in,keepaspectratio=true]{cbase}
  \qquad \includegraphics[width=2.0in,keepaspectratio=true]{csurf}}
\caption{Model for the present-day Greenland ice sheet, based on spin-up over 125,000 model years using paleo-climate forcing.  Left: ice thickness (m).  Center: basal sliding velocity (m/a).  Right: surface velocity (m/a).}
\label{fig:sr-spindone-map}
\end{figure}


The actual paleo-climate-driven spinup starts from model state \texttt{g20km_SIA.nc} but then turns on two kinds of mechanisms, climatic forcing and improved stress balance.  There are two forms of climatic forcing, firstly temperature offsets from GRIP core data which affect the snow temperature and thus the surface mass balance, so in warm periods there is more marginal ablation.  Also sea levels from the SPECMAP cores affects which part of the ice are floating.  On the other hand, there is a more complete ice dynamics model with sliding controlled by a membrane stress balance.  Namely, the SIA+SSA hybrid model.

The run now goes from the SeaRISE-Greenland-chosen start time of -125,000 years to -40,000 years.  In this period, restartable ``snapshot'' files are written into \texttt{snaps_g20km_m40ka.nc} at every 5000 model years, and scalar time series are written into \texttt{ts_g20km_m40ka.nc} at every model year.  At the end of this period we get model state file \texttt{g20km_m40ka.nc}.  Now, somewhat arbitrarily, at this point we turn on the bed deformation model and start saving model states in to files \texttt{g20km_m??ka.nc}, again every 5000 model years.

Finally we write a file for the end of the spinup, \texttt{g20km_0.nc}.  This is intended to be a good model for the Greenland ice sheet at the present day, and thus a basis on which to explore future ice sheet behavior.  Figure \ref{fig:sr-spinstart} shows some fields from the 10km model grid version of this present-day state.  The ice sheet thickness and surface velocity should be compared to present-day observations \cite{BKAJS}, and the parameter dependence explored.

Over the course of the spinup we have saved the modeled ice volume in ``time-series'' NetCDF files.  To illustrate the use of one kind of NetCDF tool, namely \verb|ncrcat| in the NCO suite of tools, these time-series are ``run-together'' in a single time-series for the whole 125,000 year period by
\begin{verbatim}
$ ncrcat ts_g20km_m40ka.nc ts_g20km_m30ka.nc ts_g20km_m20ka.nc ts_g20km_m10ka.nc \
  ts_g20km_0.nc -o ts_g20km_whole.nc
\end{verbatim}
\noindent Figure \ref{fig:sr-spindone-ivolboth} shows the ice volume time series for the whole spinup.  We see the modeled volatility of ice volume in the late ``Eemian'' period (between -120,000 and -115,000 BPE in the SeaRISE version of the GRIP temperature data).  The Figure shows that over shorter periods, like the last 10,000 years before present, there are possibly-significant differences between the 10km and 20km runs.  That the curves come close so together at time 0 is a coincidence, but both the 10km and 20km grid runs end with a volume about $3.5 \times 10^6\,\text{km}^3$, which is about 20\% higher than the present observed volume of $2.9 \times 10^6\,\text{km}^3$.

\begin{figure}[ht]
\centering
\includegraphics[width=5.6in,keepaspectratio=true]{ivolboth}
\caption{Time series of modeled ice sheet volume on 10km grid (red) and 20km grid (thin blue).  The inset shows slightly different modeled ice sheet volumes on the two grids in the final 10,000 year period before present.}
\label{fig:sr-spindone-ivolboth}
\end{figure}

The total run time for the complete 20km spinup, which models 125,000 model years with ``full physics'' of the polythermal SIA+SSA hybrid type (section \ref{sect:dynamics}) uses about 60 processor-hours.  If done without membrane stresses (SIA only) this computational time is reduced, but the polythermal (vs ``cold'') physics choice has no performance disadvantage (again, section \ref{sect:dynamics}).


\subsection{Going forward}  \label{subsect:forecastcaution}  In the same \verb|examples/searise-greenland| directory is a script \verb|forecast.sh|.  It does a ``control'' run for 500 years into the future, initializing from the modeled present-day state in \verb|g5km_0.nc| and assuming a steady climate for the entire 500 year period.  Please run it, play with it, and modify it, but it is merely a demonstration.

Because ice sheets, and ice sheet models, have a ``memory'' of past climates, whether real or modeled, the results strongly depend on the nature of the spinup process which preceded this ``forecast'' run.  Therefore, as already noted, it is critical to evaluate the quality of the spunup state, for example using present-day observations of surface velocity \cite{BKAJS}, and other observations including ice temperature in ice bore-holes.  Critical thinking about a broad range of modeling hypotheses is prerequisite to building models of future behavior.  Naive or casual use of PISM to generate ice sheet predictions is \emph{not} recommended!


\subsection{Handling NetCDF files}\label{subsect:nctoolsintro}  At a superficial level, PISM is just a program which takes one or more NetCDF files as input, does some computation, and produces one or more NetCDF files as output.  As a result, the user must and extract some meaning from the NetCDF output files and also, in the general case, use other tools to create NetCDF files for input to PISM.\footnote{Regarding the creation of input files, see the section \ref{sec:bootstrapping-format} and table \ref{tab:modelhierarchy} for ideas about the data necessary for modeling.}

The most basic tools for converting NetCDF files to and from a standard text representation are called \texttt{ncdump} and \texttt{ncgen}.  A glance at Unix \texttt{man} pages for these tools might be wise at this time.

We most-regularly use \texttt{ncview} to look at NetCDF files.  Table \ref{tab:NetCDFview} lists NetCDF tools that can be useful for for visualizing and post-processing PISM output files, and for preparing input data.  We find \texttt{ncview}, NCO, IDV and PyNGL especially useful.

\newcommand{\netcdftool}[1]{#1\index{NetCDF!tools!#1}}
\begin{table}[ht]
\centering
\caption{Some tools for viewing and modifying NetCDF files.}\label{tab:NetCDFview} 
\small
\begin{tabular}{llp{0.4\linewidth}}
  \\\toprule
  \textbf{Tool} & \textbf{Site} & \textbf{Function}\\ \midrule
\netcdftool{\texttt{ncdump}} & \emph{included with any NetCDF distribution} & dump binary NetCDF as \texttt{.cdl} (text) file \\
\netcdftool{\texttt{ncgen}} & \emph{included with any NetCDF distribution} & convert \texttt{.cdl} file to binary NetCDF \\
\netcdftool{\texttt{ncview}} & \href{http://meteora.ucsd.edu/~pierce/ncview_home_page.html}{\texttt{meteora.ucsd.edu/$\sim$pierce}} & quick graphical view \\
\netcdftool{IDV} & \href{http://www.unidata.ucar.edu/software/idv/}{\t{www.unidata.ucar.edu/software/idv/}} & more complete visualization \\
%\netcdftool{Paraview} & \href{http://www.paraview.org}{\t{www.paraview.org}} & powerful open-source parallel visualization \\
\netcdftool{NCL} &  \href{http://www.ncl.ucar.edu}{\t{www.ncl.ucar.edu}} & NCAR Command Language\\
\netcdftool{PyNGL} &  \href{http://www.pyngl.ucar.edu}{\t{www.pyngl.ucar.edu}} & Python version of NCL\\
%\netcdftool{VisIt} & \href{http://visit.llnl.gov}{\t{visit.llnl.gov}} & advanced parallel visualization \\
\netcdftool{NCO}\index{NCO (NetCDF Operators)} & \href{http://nco.sourceforge.net/}{\t{nco.sourceforge.net/}} & NetCDF Operators; command-line tools\\
\netcdftool{CDO} & \href{http://code.zmaw.de/projects/cdo}{\texttt{www.mpimet.mpg.de/fileadmin/software/cdo/}} & Climate Data Operators; more command-line tools, including conservative re-mapping
\\\bottomrule
\end{tabular}
\normalsize
\end{table}

This website gives additional NetCDF-related tools:

\centerline{ \url{http://www.unidata.ucar.edu/software/netcdf/docs/software.html} } 


%%% Local Variables: 
%%% mode: latex
%%% TeX-master: "manual"
%%% End: 


% LocalWords:  metadata SPECMAP paleo html IDV
