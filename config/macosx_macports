# Time-stamp: <macosx_macports, saved on Mon, Jan 26, 2009 at 09:50am>
# This file contains fixes necessary to build PISM on MacOS X with MacPorts.
# (Checked on MacOS X 10.5, but it should work on 10.4 too.)

# MacOS's gcc needs different switches to link shared libraries.
SHARED = -dynamiclib -undefined dynamic_lookup

# UDUNITS:
UDUNITS_CPPFLAGS = "-DNDEBUG -Df2cFortran"

# The location of headers and libraries installed via MacPorts.
MACPORTS_INCLUDE = -I/opt/local/include
MACPORTS_LIB = -L/opt/local/lib

IFLAGS += $(MACPORTS_INCLUDE) $(PETSC_INCLUDE)
LFLAGS += $(MACPORTS_LIB) -L$(PETSC_LIB_DIR)
CLINKER += $(LFLAGS)

# This is needed to make rules creating .d files find PETSc and MACPORTS.
CC += $(IFLAGS)

# This is used by the .c.o rule defined in $PETSC_DIR/bmake/common/rules
PETSC_COMPILE_SINGLE += $(MACPORTS_INCLUDE)

# Creating the TAGS database
etags:
	@etags -o ../src/TAGS `find ../src -type f|grep -v .svn|grep -v TAGS`

# Debugging
#CFLAGS += -DPISM_DEBUG